# Sistema de Gesti√≥n de Ventas, Inventario y Garant√≠as

Un sistema backend robusto, escalable y seguro desarrollado con Node.js, Express, TypeScript, PostgreSQL y JWT para la gesti√≥n completa de ventas, inventario y garant√≠as.

## üöÄ Caracter√≠sticas Principales

### Autenticaci√≥n y Seguridad
- ‚úÖ Registro e inicio de sesi√≥n de vendedores (usuarios)
- ‚úÖ Autenticaci√≥n JWT con Access Token (15 min) + Refresh Token (7 d√≠as)
- ‚úÖ Contrase√±as hasheadas con bcrypt
- ‚úÖ Middleware de autenticaci√≥n y autorizaci√≥n por roles
- ‚úÖ Cookies HTTP-only para refresh tokens
- ‚úÖ Validaci√≥n estricta de datos de entrada

### Gesti√≥n de Productos
- ‚úÖ CRUD completo de productos (nombre, descripci√≥n, SKU, stock, precio)
- ‚úÖ Filtros avanzados y b√∫squeda
- ‚úÖ Control de stock con alertas de stock bajo
- ‚úÖ Ajuste manual de inventario con auditor√≠a

### Gesti√≥n de Clientes
- ‚úÖ CRUD completo de clientes (nombre, email, tel√©fono, direcci√≥n)
- ‚úÖ Historial de compras por cliente
- ‚úÖ Estad√≠sticas de compras individuales

### Sistema de Ventas
- ‚úÖ Registro de ventas con vinculaci√≥n autom√°tica de producto, cliente y vendedor
- ‚úÖ C√°lculo autom√°tico de precios totales y fechas de garant√≠a
- ‚úÖ Subida de hasta 3 fotos por venta (sealed, full_product, serial_number)
- ‚úÖ OCR simulado para extracci√≥n de n√∫meros de serie
- ‚úÖ Actualizaci√≥n autom√°tica de stock tras ventas

### Gesti√≥n de Garant√≠as
- ‚úÖ C√°lculo autom√°tico de warranty_start y warranty_end
- ‚úÖ Consulta de garant√≠as pr√≥ximas a vencer (pr√≥ximos 30 d√≠as)
- ‚úÖ Estad√≠sticas completas de garant√≠as
- ‚úÖ Verificaci√≥n de estado de garant√≠as individuales

### Reportes y Estad√≠sticas
- ‚úÖ Dashboard con m√©tricas clave
- ‚úÖ Reportes de ventas con filtros avanzados
- ‚úÖ Reportes de inventario
- ‚úÖ An√°lisis de rendimiento por vendedor
- ‚úÖ Estad√≠sticas por per√≠odos (semanal, mensual, trimestral, anual)

## üõ†Ô∏è Tecnolog√≠as Utilizadas

- **Backend**: Node.js con TypeScript
- **Framework**: Express.js
- **Base de Datos**: PostgreSQL con consultas SQL nativas
- **Autenticaci√≥n**: JWT (jsonwebtoken)
- **Seguridad**: bcryptjs, helmet, cors
- **Validaci√≥n**: express-validator
- **Subida de Archivos**: multer (simulado con Cloudinary URLs)
- **OCR**: Simulado (preparado para Tesseract.js o Google Vision)
- **Logging**: morgan
- **Variables de Entorno**: dotenv

## üì¶ Instalaci√≥n y Configuraci√≥n

### Prerrequisitos
- Node.js (v18 o superior)
- PostgreSQL (v12 o superior)
- npm o yarn

### Pasos de Instalaci√≥n

1. **Clonar el repositorio**
   ```bash
   git clone <repository-url>
   cd sales-inventory-warranty-system
   ```

2. **Instalar dependencias**
   ```bash
   npm install
   ```

3. **Configurar variables de entorno**
   ```bash
   cp .env.example .env
   ```
   
   Editar el archivo `.env` con tus configuraciones:
   ```env
   # Variables de base de datos
   DB_HOST=localhost
   DB_PORT=5432
   DB_NAME=sales_inventory_db
   DB_USER=tu_usuario
   DB_PASSWORD=tu_contrase√±a
   
   # Variables JWT
   JWT_ACCESS_SECRET=tu_clave_secreta_access
   JWT_REFRESH_SECRET=tu_clave_secreta_refresh
   
   # Configuraci√≥n del servidor
   PORT=3000
   NODE_ENV=development
   ```

4. **Crear base de datos**
   ```sql
   CREATE DATABASE sales_inventory_db;
   ```

5. **Inicializar la aplicaci√≥n**
   ```bash
   npm run dev
   ```
   
   La aplicaci√≥n autom√°ticamente:
   - Crear√° todas las tablas necesarias
   - Configurar√° √≠ndices y triggers
   - Iniciar√° el servidor en el puerto especificado

## üöÄ Scripts Disponibles

```bash
# Desarrollo con hot reload
npm run dev

# Compilar TypeScript
npm run build

# Producci√≥n (requiere build previo)
npm start

# Tests (cuando se implementen)
npm test
```

## üìö Documentaci√≥n de la API

### Endpoints Principales

#### Autenticaci√≥n
```
POST   /api/auth/register      - Registrar nuevo usuario
POST   /api/auth/login         - Iniciar sesi√≥n
POST   /api/auth/refresh       - Renovar access token
POST   /api/auth/logout        - Cerrar sesi√≥n
GET    /api/auth/me            - Informaci√≥n del usuario actual
POST   /api/auth/change-password - Cambiar contrase√±a
```

#### Productos
```
GET    /api/products           - Listar productos (con filtros)
GET    /api/products/:id       - Obtener producto espec√≠fico
POST   /api/products           - Crear producto (Admin)
PUT    /api/products/:id       - Actualizar producto (Admin)
DELETE /api/products/:id       - Desactivar producto (Admin)
GET    /api/products/low-stock - Productos con stock bajo
POST   /api/products/:id/adjust-stock - Ajustar stock (Admin)
```

#### Clientes
```
GET    /api/customers          - Listar clientes (con filtros)
GET    /api/customers/:id      - Obtener cliente espec√≠fico
POST   /api/customers          - Crear cliente
PUT    /api/customers/:id      - Actualizar cliente
DELETE /api/customers/:id      - Eliminar cliente (Admin)
GET    /api/customers/:id/sales - Historial de ventas del cliente
GET    /api/customers/:id/statistics - Estad√≠sticas del cliente
```

#### Ventas
```
GET    /api/sales              - Listar ventas (con filtros)
GET    /api/sales/:id          - Obtener venta espec√≠fica
POST   /api/sales              - Registrar nueva venta
POST   /api/sales/:id/images   - Subir im√°genes de venta
POST   /api/sales/:id/extract-serial - Extraer n√∫mero de serie con OCR
```

#### Estad√≠sticas y Reportes
```
GET    /api/stats/dashboard    - Estad√≠sticas del dashboard
GET    /api/stats/sales        - Estad√≠sticas detalladas de ventas
GET    /api/warranties/expiring - Garant√≠as pr√≥ximas a vencer
GET    /api/warranties/statistics - Estad√≠sticas de garant√≠as
GET    /api/warranties/check/:saleId - Verificar estado de garant√≠a
GET    /api/reports/inventory  - Reporte de inventario (Admin)
GET    /api/reports/sales      - Reporte de ventas
```

### Ejemplos de Uso

#### Registrar Usuario
```bash
curl -X POST http://localhost:3000/api/auth/register \
  -H "Content-Type: application/json" \
  -d '{
    "email": "vendedor@ejemplo.com",
    "password": "contrase√±a123",
    "first_name": "Juan",
    "last_name": "P√©rez",
    "role": "seller"
  }'
```

#### Crear Producto
```bash
curl -X POST http://localhost:3000/api/products \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer TU_ACCESS_TOKEN" \
  -d '{
    "name": "Smartphone XYZ",
    "description": "Smartphone de √∫ltima generaci√≥n",
    "sku": "PHONE-XYZ-001",
    "stock": 50,
    "price": 599.99
  }'
```

#### Registrar Venta
```bash
curl -X POST http://localhost:3000/api/sales \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer TU_ACCESS_TOKEN" \
  -d '{
    "product_id": "uuid-del-producto",
    "customer_id": "uuid-del-cliente",
    "quantity": 2,
    "unit_price": 599.99,
    "warranty_period_months": 12
  }'
```

## üóÑÔ∏è Estructura de la Base de Datos

### Tablas Principales

- **users**: Usuarios del sistema (vendedores y administradores)
- **products**: Cat√°logo de productos
- **customers**: Base de datos de clientes
- **sales**: Registro de todas las ventas
- **sale_images**: Im√°genes asociadas a cada venta
- **refresh_tokens**: Tokens de refresh activos

### Caracter√≠sticas T√©cnicas

- **UUIDs**: Todos los IDs son UUID v4 para mayor seguridad
- **Triggers**: Actualizaci√≥n autom√°tica de `updated_at`
- **√çndices**: Optimizados para consultas frecuentes
- **Constraints**: Validaciones a nivel de base de datos
- **Soft Delete**: Los productos se desactivan en lugar de eliminarse

## üîß Arquitectura del Proyecto

```
src/
‚îú‚îÄ‚îÄ config/          # Configuraci√≥n y variables de entorno
‚îú‚îÄ‚îÄ controllers/     # L√≥gica de controladores
‚îú‚îÄ‚îÄ routes/          # Definici√≥n de rutas de la API
‚îú‚îÄ‚îÄ middleware/      # Autenticaci√≥n, validaci√≥n, manejo de errores
‚îú‚îÄ‚îÄ services/        # L√≥gica de negocio (OCR, garant√≠as, im√°genes)
‚îú‚îÄ‚îÄ models/          # Interfaces y tipos de TypeScript
‚îú‚îÄ‚îÄ utils/           # Funciones auxiliares (JWT, hashing, fechas)
‚îú‚îÄ‚îÄ database/        # Conexi√≥n y configuraci√≥n de PostgreSQL
‚îú‚îÄ‚îÄ app.ts           # Configuraci√≥n de la aplicaci√≥n Express
‚îî‚îÄ‚îÄ server.ts        # Servidor principal
```

## üîí Seguridad Implementada

- **JWT con doble token**: Access token corto + Refresh token largo
- **Hashing de contrase√±as**: bcrypt con 12 rounds
- **Validaci√≥n estricta**: express-validator en todos los endpoints
- **CORS configurado**: Solo or√≠genes permitidos
- **Headers de seguridad**: helmet.js
- **Rate limiting**: Preparado para implementar
- **SQL Injection**: Uso de consultas parametrizadas
- **XSS Protection**: Sanitizaci√≥n de inputs

## üìà Caracter√≠sticas de Escalabilidad

- **Pool de conexiones**: Gesti√≥n eficiente de conexiones a PostgreSQL
- **√çndices optimizados**: Para consultas frecuentes
- **Paginaci√≥n**: En todos los listados
- **Soft delete**: Preserva integridad referencial
- **Logging estructurado**: Para monitoreo en producci√≥n
- **Graceful shutdown**: Cierre ordenado del servidor
- **Environment-aware**: Configuraci√≥n por ambiente

## üîÆ Funcionalidades Futuras

### Integraciones Planeadas
- **OCR Real**: Tesseract.js o Google Vision API
- **Almacenamiento**: Cloudinary para im√°genes reales
- **Notificaciones**: Email/SMS para garant√≠as pr√≥ximas a vencer
- **Exportaci√≥n**: PDF/Excel para reportes
- **An√°litica**: Dashboard m√°s avanzado con gr√°ficos

### Mejoras T√©cnicas
- **Tests**: Suites completas de pruebas unitarias e integraci√≥n
- **Rate Limiting**: Implementaci√≥n de l√≠mites de peticiones
- **Caching**: Redis para optimizaci√≥n de consultas
- **Websockets**: Actualizaciones en tiempo real
- **Microservicios**: Separaci√≥n por dominios

## üêõ Troubleshooting

### Problemas Comunes

1. **Error de conexi√≥n a PostgreSQL**
   - Verificar que PostgreSQL est√© corriendo
   - Revisar credenciales en `.env`
   - Confirmar que la base de datos exista

2. **Errores de compilaci√≥n TypeScript**
   - Ejecutar `npm run build` para ver errores detallados
   - Verificar versi√≥n de Node.js (>= 18)

3. **Tokens JWT inv√°lidos**
   - Verificar que las claves secretas est√©n configuradas
   - Los tokens expiran seg√∫n configuraci√≥n

4. **Errores de validaci√≥n**
   - Revisar formato de datos enviados
   - Consultar documentaci√≥n de endpoints

## ü§ù Contribuci√≥n

1. Fork el proyecto
2. Crear una rama para la nueva caracter√≠stica (`git checkout -b feature/nueva-caracteristica`)
3. Commit los cambios (`git commit -am 'Agregar nueva caracter√≠stica'`)
4. Push a la rama (`git push origin feature/nueva-caracteristica`)
5. Crear un Pull Request

## üìÑ Licencia

Este proyecto est√° bajo la Licencia MIT. Ver el archivo `LICENSE` para m√°s detalles.

## üë®‚Äçüíª Autor

**Omar Godoy** - Desarrollador Full-Stack

---

## üìû Soporte

Para soporte t√©cnico o consultas sobre implementaci√≥n:
- Crear un issue en el repositorio
- Enviar email a: [tu-email@ejemplo.com]

---

*Desarrollado con ‚ù§Ô∏è usando TypeScript, Express.js y PostgreSQL*